
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>JoinNew Explicit Dataset Tutorial - OPeNDAP Documentation</title>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-JoinNew_Explicit_Dataset_Tutorial skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary" role="main">
	
	
	<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">JoinNew Explicit Dataset Tutorial</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From OPeNDAP Documentation</div>
		<div id="contentSub"></div>
		

		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Default_Values_for_the_New_Coordinate_Variable_.28on_a_Grid.29"><span class="tocnumber">1</span> <span class="toctext">Default Values for the New Coordinate Variable (on a Grid)</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Explicitly_Specifying_the_New_Coordinate_Variable"><span class="tocnumber">2</span> <span class="toctext">Explicitly Specifying the New Coordinate Variable</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Array_Virtual_Dataset"><span class="tocnumber">2.1</span> <span class="toctext">Array Virtual Dataset</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Grid_with_Explicit_Map"><span class="tocnumber">2.2</span> <span class="toctext">Grid with Explicit Map</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Errors"><span class="tocnumber">2.3</span> <span class="toctext">Errors</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Autogenerated_Uniform_Numeric_Values"><span class="tocnumber">3</span> <span class="toctext">Autogenerated Uniform Numeric Values</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Explicitly_Using_coordValue_Attribute_of_.3Cnetcdf.3E"><span class="tocnumber">4</span> <span class="toctext">Explicitly Using coordValue Attribute of &lt;netcdf&gt;</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#String_coordValue_Example"><span class="tocnumber">4.1</span> <span class="toctext">String coordValue Example</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Numeric_.28double.29_Use_of_coordValue"><span class="tocnumber">4.2</span> <span class="toctext">Numeric (double) Use of coordValue</span></a></li>
</ul>
</li>
</ul>
</div>

<h3><span class="mw-headline" id="Default_Values_for_the_New_Coordinate_Variable_.28on_a_Grid.29"><span class="mw-headline-number">1</span> Default Values for the New Coordinate Variable (on a Grid)</span></h3>
<p>The default for the new coordinate variable is to be of type String with the location of the dataset as the value.  For example, the following NcML file:
</p>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;netcdf title=&quot;Simple test of joinNew Grid aggregation&quot;&gt;
  
  &lt;aggregation type=&quot;joinNew&quot; dimName=&quot;filename&quot;&gt;
    &lt;variableAgg name=&quot;dsp_band_1&quot;/&gt; 
    &lt;netcdf location=&quot;data/ncml/agg/grids/f97182070958.hdf&quot;/&gt; 
    &lt;netcdf location=&quot;data/ncml/agg/grids/f97182183448.hdf&quot;/&gt; 
    &lt;netcdf location=&quot;data/ncml/agg/grids/f97183065853.hdf&quot;/&gt;  
    &lt;netcdf location=&quot;data/ncml/agg/grids/f97183182355.hdf&quot;/&gt; 
  &lt;/aggregation&gt; 
  
&lt;/netcdf&gt;
</pre>
<p>specifies an aggregation on a Grid variable <b>dsp_band_1</b> sampled in four HDF4 datasets listed explicitly.
</p><p>First, the data structure (DDS) is:
</p>
<pre>
Dataset {
    Grid {
      Array:
        UInt32 dsp_band_1[filename = 4][lat = 1024][lon = 1024];
      Maps:
        String filename[filename = 4];
        Float64 lat[1024];
        Float64 lon[1024];
    } dsp_band_1;
    String filename[filename = 4];
} joinNew_grid.ncml;
</pre>
<p>We see the aggregated variable <b>dsp_band_1</b> has the new outer dimension <i>filename</i>.  A coordinate variable <i>filename[filename]' was created as a sibling of the aggregated variable (the top level Grid we specified) and was also copied into the aggregated Grid as a new map vector.</i>
</p><p>The ASCII data response for just the new coordinate variable <i>filename[filename]</i> is:
</p>
<pre>
String filename[filename = 4] = {&quot;data/ncml/agg/grids/f97182070958.hdf&quot;, 
&quot;data/ncml/agg/grids/f97182183448.hdf&quot;, 
&quot;data/ncml/agg/grids/f97183065853.hdf&quot;, 
&quot;data/ncml/agg/grids/f97183182355.hdf&quot;};
</pre>
<p>We see that the absolute location we specified for the dataset as a String is the value for each element of the new coordinate variable.
</p><p>The newly added map <b>dsp_band_1.filename</b> contains a copy of this data.
</p>
<h3><span class="mw-headline" id="Explicitly_Specifying_the_New_Coordinate_Variable"><span class="mw-headline-number">2</span> Explicitly Specifying the New Coordinate Variable</span></h3>
<p>If the author wishes to have the new coordinate variable be of a specific data type with non-uniform values, then they must specify the new coordinate variable explicitly.
</p>
<h4><span class="mw-headline" id="Array_Virtual_Dataset"><span class="mw-headline-number">2.1</span> Array Virtual Dataset</span></h4>
<p>Here's an example using a contrived pure virtual dataset:
</p>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;netcdf title=&quot;JoinNew on Array with Explicit Map&quot;&gt;

  &lt;!-- joinNew and form new outer dimension &quot;day&quot; --&gt;
  &lt;aggregation type=&quot;joinNew&quot; dimName=&quot;day&quot;&gt;
    &lt;variableAgg name=&quot;V&quot;/&gt;

    &lt;netcdf title=&quot;Slice 1&quot;&gt;
      &lt;dimension name=&quot;sensors&quot; length=&quot;3&quot;/&gt;
      &lt;variable name=&quot;V&quot; type=&quot;int&quot; shape=&quot;sensors&quot;&gt;
	&lt;values&gt;1 2 3&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf title=&quot;Slice 2&quot;&gt;
      &lt;dimension name=&quot;sensors&quot; length=&quot;3&quot;/&gt;
      &lt;variable name=&quot;V&quot; type=&quot;int&quot; shape=&quot;sensors&quot;&gt;
	&lt;values&gt;4 5 6&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

  &lt;!-- This is recognized as the definition of the new coordinate variable, 
       since it has the form day[day] where day is the dimName for the aggregation. 
       It MUST be specified after the aggregation, so that the dimension size of day
      has been calculated.
  --&gt;
  &lt;variable name=&quot;day&quot; type=&quot;int&quot; shape=&quot;day&quot;&gt;
    &lt;!-- Note: metadata may be added here as normal! --&gt;
    &lt;attribute name=&quot;units&quot; type=&quot;string&quot;&gt;Days since 01/01/2010&lt;/attribute&gt;
    &lt;values&gt;1 30&lt;/values&gt;
  &lt;/variable&gt;
	     
&lt;/netcdf&gt;

</pre>
<p>The resulting DDS:
</p>
<pre>
Dataset {
    Int32 V[day = 2][sensors = 3];
    Int32 day[day = 2];
} joinNew_with_explicit_map.ncml;
</pre>
<p>and the ASCII data:
</p>
<pre>
Int32 V[day = 2][sensors = 3] = {{1, 2, 3},{4, 5, 6}};
Int32 day[day = 2] = {1, 30};
</pre>
<p>Note that the values we have explicitly given are used here as well as the specified NcML type, <i>int</i> which is mapped to a DAP Int32.  
</p><p>If metadata is desired on the new coordinate variable, it may be added just as in a normal new variable declaration.  We'll give more examples of this later.
</p>
<h4><span class="mw-headline" id="Grid_with_Explicit_Map"><span class="mw-headline-number">2.2</span> Grid with Explicit Map</span></h4>
<p>Let's give one more example using a Grid to demonstrate the recognition of the coordinate variable as it is added to the Grid as the map vector for the new dimension:
</p>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;netcdf title=&quot;joinNew Grid aggregation with explicit map&quot;&gt;
  
  &lt;aggregation type=&quot;joinNew&quot; dimName=&quot;sample_time&quot;&gt;
    &lt;variableAgg name=&quot;dsp_band_1&quot;/&gt; 
    &lt;netcdf location=&quot;data/ncml/agg/grids/f97182070958.hdf&quot;/&gt; 
    &lt;netcdf location=&quot;data/ncml/agg/grids/f97182183448.hdf&quot;/&gt; 
    &lt;netcdf location=&quot;data/ncml/agg/grids/f97183065853.hdf&quot;/&gt;  
    &lt;netcdf location=&quot;data/ncml/agg/grids/f97183182355.hdf&quot;/&gt; 
  &lt;/aggregation&gt; 
  
  &lt;!-- Note: values are contrived --&gt;
  &lt;variable name=&quot;sample_time&quot; shape=&quot;sample_time&quot; type=&quot;float&quot;&gt;
    &lt;!-- Metadata here will also show up in the Grid map --&gt;
    &lt;attribute name=&quot;units&quot; type=&quot;string&quot;&gt;Days since 01/01/2010&lt;/attribute&gt;
    &lt;values&gt;100 200 400 1000&lt;/values&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;
</pre>
<p>This produces the DDS:
</p>
<pre>
Dataset {
    Grid {
      Array:
        UInt32 dsp_band_1[sample_time = 4][lat = 1024][lon = 1024];
      Maps:
        Float32 sample_time[sample_time = 4];
        Float64 lat[1024];
        Float64 lon[1024];
    } dsp_band_1;
    Float32 sample_time[sample_time = 4];
} joinNew_grid_explicit_map.ncml;
</pre>
<p>You can see the explicit coordinate variable <b>sample_time</b> was found as the sibling of the aggregated Grid as was added as the new map vector for the Grid.
</p><p>The values for the projected coordinate variables are as expected:
</p>
<pre>
Float32 sample_time[sample_time = 4] = {100, 200, 400, 1000};
</pre>
<h4><span class="mw-headline" id="Errors"><span class="mw-headline-number">2.3</span> Errors</span></h4>
<p>It is a Parse Error to:
</p>
<ul>
<li> Give a different number of values for the explicit coordinate variable than their are specified datasets
</li>
<li> Specify the new coordinate variable prior to the &lt;aggregation&gt; element since the dimension size is not yet known
</li>
</ul>
<p><br />
</p>
<h3><span class="mw-headline" id="Autogenerated_Uniform_Numeric_Values"><span class="mw-headline-number">3</span> Autogenerated Uniform Numeric Values</span></h3>
<p>If the number of datasets might vary (for example, if a &lt;scan&gt; element, described later, is used), but the values are uniform, the start/increment version of the &lt;values&gt; element may be used to generate the values for the new coordinate variable.  For example:
</p>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;netcdf title=&quot;JoinNew on Array with Explicit Autogenerated Map&quot;&gt;

  &lt;aggregation type=&quot;joinNew&quot; dimName=&quot;day&quot;&gt;
    &lt;variableAgg name=&quot;V&quot;/&gt;

    &lt;netcdf title=&quot;Slice 1&quot;&gt;
      &lt;dimension name=&quot;sensors&quot; length=&quot;3&quot;/&gt;
      &lt;variable name=&quot;V&quot; type=&quot;int&quot; shape=&quot;sensors&quot;&gt;
	&lt;values&gt;1 2 3&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf title=&quot;Slice 2&quot;&gt;
      &lt;dimension name=&quot;sensors&quot; length=&quot;3&quot;/&gt;
      &lt;variable name=&quot;V&quot; type=&quot;int&quot; shape=&quot;sensors&quot;&gt;
	&lt;values&gt;4 5 6&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

  &lt;!-- Explicit coordinate variable definition --&gt;
  &lt;variable name=&quot;day&quot; type=&quot;int&quot; shape=&quot;day&quot;&gt;
    &lt;attribute name=&quot;units&quot; type=&quot;string&quot; value=&quot;days since 2000-01-01 00:00&quot;/&gt;
    &lt;!-- We sample once a week... --&gt;
    &lt;values start=&quot;1&quot; increment=&quot;7&quot;/&gt;
  &lt;/variable&gt;
	     
&lt;/netcdf&gt;
</pre>
<p>The DDS is the same as before and the coordinate variable is generated as expected:
</p>
<pre>
Int32 sample_time[sample_time = 4] = {1, 8, 15, 22};
</pre>
<p>Note that this form is useful for uniform sampled datasets (or if only a numeric index is desired) where the variable need not be changed as datasets are added.  It is especially useful for a &lt;scan&gt; element that refers to a dynamic number of files that can be described with a uniformly varying index.
</p>
<h3><span class="mw-headline" id="Explicitly_Using_coordValue_Attribute_of_.3Cnetcdf.3E"><span class="mw-headline-number">4</span> Explicitly Using coordValue Attribute of &lt;netcdf&gt;</span></h3>
<p>The <i>netcdf@coordValue</i> may be used to specify the value for the given dataset right where the dataset is declared.  This attribute will cause a coordinate variable to be automatically generated with the given values for each dataset filled in.  The new coordinate variable will be of type <b>double</b> if the coordValue's can all be parsed as a number, otherwise they will be of type <b>String</b>.
</p>
<h4><span class="mw-headline" id="String_coordValue_Example"><span class="mw-headline-number">4.1</span> String coordValue Example</span></h4>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;netcdf title=&quot;joinNew Aggregation with explicit string coordValue&quot;&gt;
  
  &lt;aggregation type=&quot;joinNew&quot; dimName=&quot;source&quot;&gt;
    &lt;variableAgg name=&quot;u&quot;/&gt;
    &lt;variableAgg name=&quot;v&quot;/&gt;

    &lt;!-- Same dataset a few times, but with different coordVal --&gt;
    &lt;netcdf title=&quot;Dataset 1&quot; location=&quot;data/ncml/fnoc1.nc&quot; coordValue=&quot;Station_1&quot;/&gt;
    &lt;netcdf title=&quot;Dataset 2&quot; location=&quot;data/ncml/fnoc1.nc&quot; coordValue=&quot;Station_2&quot;/&gt;
    &lt;netcdf title=&quot;Dataset 3&quot; location=&quot;data/ncml/fnoc1.nc&quot; coordValue=&quot;Station_3&quot;/&gt;
  &lt;/aggregation&gt;

&lt;/netcdf&gt;

</pre>
<p>This results in the following DDS:
</p>
<pre>
Dataset {
    Int16 u[source = 3][time_a = 16][lat = 17][lon = 21];
    Int16 v[source = 3][time_a = 16][lat = 17][lon = 21];
    Float32 lat[lat = 17];
    Float32 lon[lon = 21];
    Float32 time[time = 16];
    String source[source = 3];
} joinNew_string_coordVal.ncml;
</pre>
<p>and ASCII data response of the projected coordinate variable is:
</p>
<pre>
String source[source = 3] = {&quot;Station_1&quot;, &quot;Station_2&quot;, &quot;Station_3&quot;};
</pre>
<p>as we specified.
</p>
<h4><span class="mw-headline" id="Numeric_.28double.29_Use_of_coordValue"><span class="mw-headline-number">4.2</span> Numeric (double) Use of coordValue</span></h4>
<p>If the first <i>coordValue</i> can be successfully parsed as a double numeric type, then a coordinate variable of type double (Float64) is created and all remaining <i>coordValue</i> specifications <b>must</b> be parsable as a double or a Parse Error is thrown.
</p><p>Using the same example but with numbers instead:
</p>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;netcdf title=&quot;joinNew Aggregation with numeric coordValue&quot;&gt;
  
  &lt;aggregation type=&quot;joinNew&quot; dimName=&quot;source&quot;&gt;
    &lt;variableAgg name=&quot;u&quot;/&gt;
    &lt;variableAgg name=&quot;v&quot;/&gt;

    &lt;!-- Same dataset a few times, but with different coordVal --&gt;
    &lt;netcdf title=&quot;Dataset 1&quot; location=&quot;data/ncml/fnoc1.nc&quot; coordValue=&quot;1.2&quot;/&gt;
    &lt;netcdf title=&quot;Dataset 2&quot; location=&quot;data/ncml/fnoc1.nc&quot; coordValue=&quot;3.4&quot;/&gt;
    &lt;netcdf title=&quot;Dataset 3&quot; location=&quot;data/ncml/fnoc1.nc&quot; coordValue=&quot;5.6&quot;/&gt;

  &lt;/aggregation&gt;
&lt;/netcdf&gt;
</pre>
<p>This time we see that a Float64 array is created:
</p>
<pre>
Dataset {
    Int16 u[source = 3][time_a = 16][lat = 17][lon = 21];
    Int16 v[source = 3][time_a = 16][lat = 17][lon = 21];
    Float32 lat[lat = 17];
    Float32 lon[lon = 21];
    Float32 time[time = 16];
    Float64 source[source = 3];
} joinNew_numeric_coordValue.ncml;
</pre>
<p>The values we specified are in the coordinate variable ASCII data:
</p>
<pre>
Float64 source[source = 3] = {1.2, 3.4, 5.6};
</pre>




</div>
				<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
</body></html>