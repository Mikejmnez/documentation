
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>Hyrax WMS - OPeNDAP Documentation</title>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Hyrax_WMS skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary" role="main">
	
	
	<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Hyrax WMS</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From OPeNDAP Documentation</div>
		<div id="contentSub"></div>
		

		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Hyrax now works with <a rel="nofollow" class="external text" href="http://www.resc.rdg.ac.uk/trac/ncWMS/">ncWMS2</a>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Theory_of_Operation"><span class="tocnumber">1.1</span> <span class="toctext">Theory of Operation</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Evaluating_Candidate_Datasets"><span class="tocnumber">1.2</span> <span class="toctext">Evaluating Candidate Datasets</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#WMS_Installation_.28suggested.29"><span class="tocnumber">2</span> <span class="toctext">WMS Installation (suggested)</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#OLFS.2FHyrax_Installation"><span class="tocnumber">3</span> <span class="toctext">OLFS/Hyrax Installation</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Co-Configuration"><span class="tocnumber">4</span> <span class="toctext">Co-Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#ncWMS2_configuration"><span class="tocnumber">4.1</span> <span class="toctext">ncWMS2 configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#Authenticate_as_the_Administrator"><span class="tocnumber">4.1.1</span> <span class="toctext">Authenticate as the Administrator</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Configure_a_Dynamic_Service"><span class="tocnumber">4.1.2</span> <span class="toctext">Configure a Dynamic Service</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#Hyrax_Configuration"><span class="tocnumber">4.2</span> <span class="toctext">Hyrax Configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#NcWmsServce"><span class="tocnumber">4.2.1</span> <span class="toctext">NcWmsServce</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#GodivaWebService"><span class="tocnumber">4.2.2</span> <span class="toctext">GodivaWebService</span></a>
<ul>
<li class="toclevel-4 tocsection-13"><a href="#Apache_configuration"><span class="tocnumber">4.2.2.1</span> <span class="toctext">Apache configuration</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#Start_and_Test"><span class="tocnumber">5</span> <span class="toctext">Start and Test</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#Issues"><span class="tocnumber">6</span> <span class="toctext">Issues</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Known_Logging_Issue"><span class="tocnumber">6.1</span> <span class="toctext">Known Logging Issue</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#The_Symptom"><span class="tocnumber">6.1.1</span> <span class="toctext">The Symptom</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#The_Fix"><span class="tocnumber">6.1.2</span> <span class="toctext">The Fix</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview"><span class="mw-headline-number">1</span> Overview</span></h2>
<p>With the recent addition of the Dynamic Services feature in the <a rel="nofollow" class="external text" href="http://www.resc.rdg.ac.uk/trac/ncWMS/">ncWMS2 WMS Server</a> from <a rel="nofollow" class="external text" href="http://www.resc.reading.ac.uk/">Reading e-Science Centre</a> Hyrax can now provide WMS services for all of it's appropriate holdings.
</p>
<h3><span class="mw-headline" id="Theory_of_Operation"><span class="mw-headline-number">1.1</span> Theory of Operation</span></h3>
<p>In an instance of the ncWMS2 WMS server, a Dynamic Service is configured that points to a Hyrax server. This allows the ncWMS2 instance to access all of the holdings of the DAP server. However, the ncWMS2 does not "crawl" or "discover" or in any other way catalog or inventory the DAP server. Instead the user configures the Hyrax server to add the WMS service to its catalogs and services content. Hyrax then directs WMS traffic to the ncWMS2 instance. The ncWMS2 in turn retrieves the data directly from Hyrax and services the request.
</p><p>The ncWMS2 instance may be hosted anywhere, however for a significant performance improvement we suggest you host your own ncWMS2 running in the same Tomcat instance as Hyrax's OLFS. With such a configuration the WMS response performance for datasets backed by the DAP service is nearly as fast as the ncWMS2 response performance using direct file access.
</p>
<h3><span class="mw-headline" id="Evaluating_Candidate_Datasets"><span class="mw-headline-number">1.2</span> Evaluating Candidate Datasets</span></h3>
<p>In order for ncWMS2 to recognize your dataset as valid for service your data must:
</p>
<ul>
<li> Contain gridded data (as DAP Grid objects or DAP Array objects utilizing shared dimensional coordinate arrays) <b><a rel="nofollow" class="external text" href="http://www.unidata.ucar.edu/software/thredds/v4.3/netcdf-java/tutorial/GridDatatype.html">as described by the Unidata Common Data Model</a></b>.
</li>
<li> The NetCDF-Java library (which is what provides data access services for ncWMS2) utilizes the Common Data Model and must be able to identify the coordinates system used. You can test this by using the <b><a rel="nofollow" class="external text" href="http://www.unidata.ucar.edu/software/thredds/current/netcdf-java/documentation.htm">Unidata ToolsUI application</a></b> (which is also based on the NetCDF-Java library). Open your dataset with <b>ToolsUI</b>, and in the <b>Feature Types -&gt; Grid Panel</b> there should be one or more variables shown with some kind of coordinate system.
</li>
</ul>
<div class="thumb tleft"><div class="thumbinner" style="width:948px;"><a href="../index.php/File:ToolsUI-GridView.png" class="image"><img alt="" src="../images/0/0f/ToolsUI-GridView.png" width="946" height="445" class="thumbimage" /></a>  <div class="thumbcaption">ToolsUI Grid View</div></div></div>
 <div style="clear: both"></div>
<pre><i>Note that <b>ToolsUI</b> supports opening both local files and remote (http accessible) datasets.</i>
</pre>
<h2><span class="mw-headline" id="WMS_Installation_.28suggested.29"><span class="mw-headline-number">2</span> WMS Installation (suggested)</span></h2>
<p>The ncWMS2 web application is easy to install. 
</p><p>Simply:
</p>
<ul>
<li> Retrieve the latest stable release from <a rel="nofollow" class="external free" href="https://github.com/Reading-eScience-Centre/edal-java/releases">https://github.com/Reading-eScience-Centre/edal-java/releases</a>
</li>
</ul>
<ul>
<li> Copy the WAR files <i>ncWMS2.war</i> and <i>opendap.war</i> into the  <i>$CATALINA_HOME/webapps</i> directory
</li>
</ul>
<ul>
<li> Restart Tomcat
</li>
</ul>
<h2><span class="mw-headline" id="OLFS.2FHyrax_Installation"><span class="mw-headline-number">3</span> OLFS/Hyrax Installation</span></h2>
<p>As of the release of Hyrax 1.11 (and in particular OLFS 1.13.0) the support for WMS will be built into the server. All that is required is a (collocated) ncWMS2 instance and then the configuration steps as detailed below. So - get the latest Hyrax (1.11.0 or later) install and configure using the normal methods and then follow the configuration steps detailed below.
</p>
<h2><span class="mw-headline" id="Co-Configuration"><span class="mw-headline-number">4</span> Co-Configuration</span></h2>
<p>The following sub sections assume that you have installed both Hyrax and the ncWMS2 on your server in a single Tomcat instance running on port 8080. If your arrangement is otherwise you will need to adjust accordingly. 
</p><p>For the following example sections we will use the following URLs:
</p>
<ul>
<li> Your Tomcat server: <a rel="nofollow" class="external free" href="http://servername.org:8080/">http://servername.org:8080/</a>
</li>
<li> Top level of DAP server:  <a rel="nofollow" class="external free" href="http://servername.org:8080/opendap">http://servername.org:8080/opendap</a>
</li>
<li> Top Level of ncWMS2: <a rel="nofollow" class="external free" href="http://servername.org:8080/ncWMS2">http://servername.org:8080/ncWMS2</a>
</li>
<li> WMS Service: <a rel="nofollow" class="external free" href="http://servername.org:8080/ncWMS2/wms">http://servername.org:8080/ncWMS2/wms</a>
</li>
<li> Godiva: <a rel="nofollow" class="external free" href="http://servername.org:8080/ncWMS2/Godiva3.html">http://servername.org:8080/ncWMS2/Godiva3.html</a>
</li>
</ul>
<h3><span class="mw-headline" id="ncWMS2_configuration"><span class="mw-headline-number">4.1</span> ncWMS2 configuration</span></h3>
<h4><span class="mw-headline" id="Authenticate_as_the_Administrator"><span class="mw-headline-number">4.1.1</span> Authenticate as the Administrator</span></h4>
<p>In order to access the ncWMS2 administration page (which you must do in oder to configure the server) you will need to configure authentication and access control for the page, or you will need to temporarily disable access control for the page in order to configure the server (I strongly recommend the former).
</p><p>The default security configuration for ncWMS2 can be located (after initial launch) in the file:
</p>
<dl>
<dd><tt>$CATALINA_HOME/webapps/ncWMS2/WEB-INF/web.xml</tt>
</dd>
</dl>
<p>This configuration stipulates that access to the <i>ncWMS2/admin</i> pages must be over a secure transport and that there will be no access without being authenticated and in the <b><tt>manager</tt></b> role:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc-1">&lt;!-- Define a Security Constraint on the Admin command and user interfaces --&gt;</span>
<span class="sc3"><span class="re1">&lt;security-constraint<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;web-resource-collection<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;web-resource-name<span class="re2">&gt;</span></span></span>admin<span class="sc3"><span class="re1">&lt;/web-resource-name<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;url-pattern<span class="re2">&gt;</span></span></span>/admin/*<span class="sc3"><span class="re1">&lt;/url-pattern<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/web-resource-collection<span class="re2">&gt;</span></span></span>
&#160;
    <span class="sc3"><span class="re1">&lt;auth-constraint<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;role-name<span class="re2">&gt;</span></span></span>manager<span class="sc3"><span class="re1">&lt;/role-name<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/auth-constraint<span class="re2">&gt;</span></span></span>
&#160;
    <span class="sc3"><span class="re1">&lt;user-data-constraint<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;transport-guarantee<span class="re2">&gt;</span></span></span>CONFIDENTIAL<span class="sc3"><span class="re1">&lt;/transport-guarantee<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/user-data-constraint<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/security-constraint<span class="re2">&gt;</span></span></span></pre></div></div>
<p>Your choices:
</p>
<ol>
<li> <b>Use Apache httpd to provide authentication services for your installation. </b>
<ol>
<li> Comment out the <tt>security-constraint</tt> in the <tt>web.xml</tt> file for ncWMS2.
</li>
<li> Correctly integrate Tomcat and Apache using the AJP connector.
</li>
<li> Configure an Apache httpd <tt>&lt;Location&gt;</tt> directive for the <tt>ncWMS2/admin</tt> page.
</li>
<li> Write the directive to restrict access to specific users.  
</li>
</ol>
</li>
<li> <b>Use Tomcat authentication.</b>
<ol>
<li> Leave the <tt>security-constraint</tt> in place.
</li>
<li> Correctly configure Tomcat to use some type authentication (e.g., MemoryRealm).
</li>
<li> Modify the <tt>security-constraint</tt> to reflect your authentication configuration. (Different role? HTTPS? etc.)
</li>
</ol>
</li>
<li> <b>Temporarily Disable the <tt>security-constraint</tt>.</b>
<ol>
<li> Comment out the <tt>security-constraint</tt> in the <tt>web.xml</tt> file for ncWMS2.
</li>
<li> Finish the configuration steps below.
</li>
<li> At the end, when it's working, go back and un-comment the  <tt>security-constraint</tt> in the web.xml file for ncWMS2.
</li>
<li> Restart Tomcat.
</li>
</ol>
</li>
</ol>
<p>Now that you can get to it, go to the ncWMS2 administration page:  <a rel="nofollow" class="external free" href="http://servername.org:8080/ncWMS2/admin/">http://servername.org:8080/ncWMS2/admin/</a>
</p><p><b>NB:</b> <i>Any changes you make to the <tt>web.xml</tt> are volatile! Installing/Upgrading/Reinstalling the web archive (.war) file will overwrite <tt>web.xml</tt> file. Make a back-up copy of the <tt>web.xml</tt> in a different, more durable location.</i>
</p>
<h4><span class="mw-headline" id="Configure_a_Dynamic_Service"><span class="mw-headline-number">4.1.2</span> Configure a Dynamic Service</span></h4>
<p>Once you have authenticated and can view the ncWMS2 admin page, scroll down to the Dynamic Services section:
</p>
<p>
<a href="../index.php/File:Screen_Shot_2014-08-11_at_12.34.19_PM.png" class="image" title="ncWMS Admin Page - Partial Screen Grab"><img alt="ncWMS Admin Page - Partial Screen Grab" src="../images/1/1a/Screen_Shot_2014-08-11_at_12.34.19_PM.png" width="792" height="281" class="thumbborder" /></a>
</p>
<p>Create a new Dynamic Service for Hyrax:
</p>
<ul>
<li> Choose and enter a unique ID. (Using 'lds' will save you the trouble of having to edit the olfs configuration viewers.xml file to adjust that value.) Write down the string/name you use because you'll need it later.
</li>
<li> The value of the <i>Service URL</i> field will be the URL for the top level of the Hyrax server. 
<ul>
<li> If the Hyrax server and the ncWMS2 server are running together in a single Tomcat instance then this URL <b>should</b> be expressed as: <a rel="nofollow" class="external free" href="http://localhost:8080/opendap">http://localhost:8080/opendap</a>  
</li>
<li> If the Hyrax server and the ncWMS2 server are running on separate systems this URL <b>must</b> be a DAP server top level URL, and not a localhost URL.
</li>
<li> <b>Best WMS response performance will be achieved by running ncWMS2 and Hyrax on the same server and providing the <i>localhost</i> URL here.</b>
</li>
</ul>
</li>
<li> The Dataset Match Regex should be a regex that matches of all of the data files you have for which WMS can prove services. If that's too cumbersome then just use '.*' (as in the example) which matches everything.
</li>
<li> Scroll to the bottom of the page and save the configuration.
</li>
</ul>
<p><b>Summary</b>
</p>
<table class="wikitable" style="text-align: center;">
<tr>
<th> Unique ID
</th>
<th> Service URL
</th>
<th> Dataset Match Regex
</th>
<th> Disabled?
</th>
<th> Remove
</th>
<th> Data Reading Class
</th>
<th> Link to more info
</th>
<th> Copyright Statement
</th></tr>
<tr>
<td>lds
</td>
<td><a rel="nofollow" class="external free" href="http://localhost:8080/opendap">http://localhost:8080/opendap</a>
</td>
<td>.*
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td></tr></table>
<h3><span class="mw-headline" id="Hyrax_Configuration"><span class="mw-headline-number">4.2</span> Hyrax Configuration</span></h3>
<p>The Hyrax WMS configuration is contained in the file  <i>$OLFS_CONFIG_DIR/viewers.xml</i>. This file identifies data viewers and Web Services that Hyrax can provide for datasets. There are two relevant sections, the first defines Hyrax's view of the WMS service and the second enables Hyrax to provide access to the Godiva service that is part of ncWMS.
</p><p><br />
Edit the file <i>$OLFS_CONFIG_DIR/viewers.xml</i>
</p><p><br />
Uncomment the following sections:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc-1">&lt;!--</span>
<span class="sc-1">    &lt;WebServiceHandler className=&quot;opendap.viewers.NcWmsService&quot; serviceId=&quot;ncWms&quot; &gt;</span>
<span class="sc-1">        &lt;applicationName&gt;Web Mapping Service&lt;/applicationName&gt;</span>
<span class="sc-1">        &lt;NcWmsService href=&quot;/ncWMS2/wms&quot; base=&quot;/ncWMS2/wms&quot; ncWmsDynamicServiceId=&quot;lds&quot; /&gt;</span>
<span class="sc-1">    &lt;/WebServiceHandler&gt;</span>
&#160;
<span class="sc-1">    &lt;WebServiceHandler className=&quot;opendap.viewers.GodivaWebService&quot; serviceId=&quot;godiva&quot; &gt;</span>
<span class="sc-1">        &lt;applicationName&gt;Godiva WMS GUI&lt;/applicationName&gt;</span>
<span class="sc-1">        &lt;NcWmsService href=&quot;http://YourServersNameHere:8080/ncWMS2/wms&quot; base=&quot;/ncWMS2/wms&quot; ncWmsDynamicServiceId=&quot;lds&quot;/&gt;</span>
<span class="sc-1">        &lt;Godiva href=&quot;/ncWMS2/Godiva3.html&quot; base=&quot;/ncWMS2/Godiva3.html&quot;/&gt;</span>
<span class="sc-1">    &lt;/WebServiceHandler&gt;</span>
<span class="sc-1">--&gt;</span></pre></div></div>
<h4><span class="mw-headline" id="NcWmsServce"><span class="mw-headline-number">4.2.1</span> NcWmsServce</span></h4>
<p>In the first section:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;WebServiceHandler</span> <span class="re0">className</span>=<span class="st0">&quot;opendap.viewers.NcWmsService&quot;</span> <span class="re0">serviceId</span>=<span class="st0">&quot;ncWms&quot;</span> <span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;applicationName<span class="re2">&gt;</span></span></span>Web Mapping Service<span class="sc3"><span class="re1">&lt;/applicationName<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;NcWmsService</span> <span class="re0">href</span>=<span class="st0">&quot;/ncWMS2/wms&quot;</span> <span class="re0">base</span>=<span class="st0">&quot;/ncWMS2/wms&quot;</span> <span class="re0">ncWmsDynamicServiceId</span>=<span class="st0">&quot;lds&quot;</span> <span class="re2">/&gt;</span></span>
<span class="sc3"><span class="re1">&lt;/WebServiceHandler<span class="re2">&gt;</span></span></span></pre></div></div>
<p>Edit the <i>NcWmsService</i> element so that:
</p>
<ul>
<li> The value of the <i>ncWmsDynamicServiceId</i> matches the <i>Unique ID</i> of the Dynamic Service you defined in ncWMS.
</li>
</ul>
<ul>
<li> NB: The <i>href</i> and <i>base</i> attributes both use relative URL paths to locate the ncWMS service. If the ncWMS instance is NOT running on the same host as Hyrax then  the values of the <i>href</i> and <i>base</i> attributes must be converted to fully qualified URLs.
</li>
</ul>
<p><br />
</p>
<h4><span class="mw-headline" id="GodivaWebService"><span class="mw-headline-number">4.2.2</span> GodivaWebService</span></h4>
<p>In the second section:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;WebServiceHandler</span> <span class="re0">className</span>=<span class="st0">&quot;opendap.viewers.GodivaWebService&quot;</span> <span class="re0">serviceId</span>=<span class="st0">&quot;godiva&quot;</span> <span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;applicationName<span class="re2">&gt;</span></span></span>Godiva WMS GUI<span class="sc3"><span class="re1">&lt;/applicationName<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;NcWmsService</span> <span class="re0">href</span>=<span class="st0">&quot;http://yourNcWMSserver:8080/ncWMS2/wms&quot;</span> <span class="re0">base</span>=<span class="st0">&quot;/ncWMS2/wms&quot;</span> <span class="re0">ncWmsDynamicServiceId</span>=<span class="st0">&quot;lds&quot;</span><span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;Godiva</span> <span class="re0">href</span>=<span class="st0">&quot;/ncWMS2/Godiva3.html&quot;</span> <span class="re0">base</span>=<span class="st0">&quot;/ncWMS2/Godiva3.html&quot;</span><span class="re2">/&gt;</span></span>
<span class="sc3"><span class="re1">&lt;/WebServiceHandler<span class="re2">&gt;</span></span></span></pre></div></div>
<p>Edit the <i>NcWmsService</i> element so that:
</p>
<ul>
<li> The value of the <i>href</i> attribute is the fully qualified URL for public access to your WMS service. The server name in this <i>href</i> should not be <i>localhost</i> - Godiva won't work for users on other computers if you use <i>localhost</i> for the host name.
</li>
<li> The value of the <i>ncWmsDynamicServiceId</i> matches the <i>Unique ID</i> of the Dynamic Service you defined in ncWMS2.
</li>
</ul>
<p>The <i>Godiva</i> element's <i>href</i> and <i>base</i> attributes both use relative URL paths to locate the Godiva service. If the ncWMS2 instance is NOT running on the same host as Hyrax then  the values of the <i>href</i> and <i>base</i> attributes must be converted to fully qualified URLs.
</p>
<h5><span class="mw-headline" id="Apache_configuration"><span class="mw-headline-number">4.2.2.1</span> Apache configuration</span></h5>
<p>If you are running Hyrax with Apache linked to Tomcat (a fairly simple configuration described here), then add the following to the <i>httpd.conf</i> file:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1"><span class="co0"># This is needed to configure ncWMS2 so that it will work when               </span>
<span class="co0"># users access Hyrax using Apache (port 80). Because Godiva was             </span>
<span class="co0"># configured in the olfs viewers.xml using &lt;hostname&gt;:8080, the             </span>
<span class="co0"># Godiva WMS service works when Hyrax is accesed over port 8080             </span>
<span class="co0"># too.                                                                      </span>
ProxyPass <span class="sy0">/</span>ncWMS2 ajp:<span class="sy0">//</span>localhost:<span class="nu0">8009</span><span class="sy0">/</span>ncWMS2</pre></div></div>
<p>This will form the linkage needed to access the Godiva interface when people access your server using Apache. Note that by using port <i>8080</i> in <i>yourNcWMSserver:8080</i> for the value of the <i>WebServiceHandler</i> element, people will be able to access Godiva when talking to Hyrax directly via Tomcat. This configuration covers both access options.
</p>
<h2><span class="mw-headline" id="Start_and_Test"><span class="mw-headline-number">5</span> Start and Test</span></h2>
<ul>
<li> Once the configuration steps are complete restart your Tomcat server.
</li>
<li> Point your browser at the Hyrax sever and navigate to a WMS-suitable dataset. 
</li>
<li> Clicking the dataset's <b>Viewers</b> link should return a page with both WMS and Godiva links.
</li>
<li> Try 'em.
</li>
</ul>
<p><br />
</p>
<h2><span class="mw-headline" id="Issues"><span class="mw-headline-number">6</span> Issues</span></h2>
<h3><span class="mw-headline" id="Known_Logging_Issue"><span class="mw-headline-number">6.1</span> Known Logging Issue</span></h3>
<ul>
<li> <i>Applies to ncWMS version 1.x</i>
</li>
</ul>
<p>There is a small issue with deploying this configuration onto some Linux system in which everything has been installed from RPM (except maybe Tomcat and it's components including the ncWMS and Hyrax applications)
</p><p><br />
</p>
<h4><span class="mw-headline" id="The_Symptom"><span class="mw-headline-number">6.1.1</span> The Symptom</span></h4>
<p>The issue appears in the Tomcat log as a failure to lock files associated with the java.util.prefs.FileSystemPreferences:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="systemverilog source-systemverilog"><pre class="de1">Dec <span class="nu0">12</span><span class="sy0">,</span> <span class="nu0">2014</span> <span class="nu0">1</span><span class="sy0">:</span><span class="nu0">17</span><span class="sy0">:</span><span class="nu0">28</span> PM java.util.prefs.FileSystemPreferences checkLockFile0ErrorCode
WARNING<span class="sy0">:</span> Could <span class="kw5">not</span> lock System prefs. Unix error code <span class="nu0">32612</span>.
Dec <span class="nu0">12</span><span class="sy0">,</span> <span class="nu0">2014</span> <span class="nu0">1</span><span class="sy0">:</span><span class="nu0">17</span><span class="sy0">:</span><span class="nu0">28</span> PM java.util.prefs.FileSystemPreferences syncWorld
WARNING<span class="sy0">:</span> Couldn't flush system prefs<span class="sy0">:</span> java.util.prefs.BackingStoreException<span class="sy0">:</span> Couldn't <span class="kw7">get</span> file lock.
Dec <span class="nu0">12</span><span class="sy0">,</span> <span class="nu0">2014</span> <span class="nu0">1</span><span class="sy0">:</span><span class="nu0">17</span><span class="sy0">:</span><span class="nu0">58</span> PM java.util.prefs.FileSystemPreferences checkLockFile0ErrorCode
WARNING<span class="sy0">:</span> Could <span class="kw5">not</span> lock System prefs. Unix error code <span class="nu0">32612</span>.
Dec <span class="nu0">12</span><span class="sy0">,</span> <span class="nu0">2014</span> <span class="nu0">1</span><span class="sy0">:</span><span class="nu0">17</span><span class="sy0">:</span><span class="nu0">58</span> PM java.util.prefs.FileSystemPreferences syncWorld
WARNING<span class="sy0">:</span> Couldn't flush system prefs<span class="sy0">:</span> java.util.prefs.BackingStoreException<span class="sy0">:</span> Couldn't <span class="kw7">get</span> file lock.</pre></div></div>
<p>And is logged every 30 seconds or so. So the problem is the logs fill up with this issue and not stuff we care about. The problem is that the files/directories in question either don't exist, or, if they do exist the Tomcat user does not have read/write permissions on them.
</p>
<h4><span class="mw-headline" id="The_Fix"><span class="mw-headline-number">6.1.2</span> The Fix</span></h4>
<p>I looked around and discovered that a number of people (including TDS deployers) had experienced this issue. It's a Linux problem and involves the existence and permissions of a global system preferences directory. I think this is only an issue on Linux systems in which everything is installed via yum/rpm, which may be why we only see this problem on certain systems, but I not 100% confident that the issue is limited only to this type of installation.
</p><p>I found and tested these two ways to solve it:
</p>
<dl>
<dt> 1) Create the global System Preference directory and set the owner to the Tomcat user
</dt>
</dl>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">   <span class="kw2">sudo</span> <span class="kw2">mkdir</span> <span class="re5">-P</span> <span class="sy0">/</span>etc<span class="sy0">/</span>.java<span class="sy0">/</span>.systemPrefs
   <span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> tomcat-user <span class="sy0">/</span>etc<span class="sy0">/</span>.java<span class="sy0">/</span>.systemPrefs</pre></div></div>
<dl>
<dd> This could also be accomplished by changing the group ownership to the tomcat-group and setting the group read/write flags.
</dd>
</dl>
<p><br />
</p>
<dl>
<dt>2) Create a java System Preference directory for the "tomcat-user" (adjust name that for your circumstance) and then set the JAVA_OPTS environment variable so that the systemRoot value is set the new directory
</dt>
</dl>
<p>Create the directory
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">   <span class="kw2">mkdir</span> <span class="re5">-P</span> <span class="sy0">/</span>home<span class="sy0">/</span>tomcat-user<span class="sy0">/</span>.java<span class="sy0">/</span>.systemPrefs
   <span class="kw2">sudo</span> <span class="kw2">chown</span> <span class="re5">-R</span> tomcat-user <span class="sy0">/</span>home<span class="sy0">/</span>tomcat-user<span class="sy0">/</span>.java<span class="sy0">/</span>.systemPrefs</pre></div></div>
<p>Then, in each shell that launches Tomcat:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">   <span class="kw3">export</span> <span class="re2">JAVA_OPTS</span>=<span class="st0">&quot;-Djava.util.prefs.systemRoot=/home/tomcat-user/.java&quot;</span>
   <span class="re1">$CATALINA_HOME</span><span class="sy0">/</span>bin<span class="sy0">/</span>startup.sh</pre></div></div>




</div>
				<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
</body></html>