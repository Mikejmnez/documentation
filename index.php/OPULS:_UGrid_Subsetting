
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>OPULS: UGrid Subsetting - OPeNDAP Documentation</title>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-OPULS_UGrid_Subsetting skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary" role="main">
	
	
	<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">OPULS: UGrid Subsetting</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From OPeNDAP Documentation</div>
		<div id="contentSub"></div>
		

		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Background_information_on_UGrid_0.9.0"><span class="tocnumber">2</span> <span class="toctext">Background information on UGrid 0.9.0</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#The_ugrid_subsetting_functions"><span class="tocnumber">3</span> <span class="toctext">The ugrid subsetting functions</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#ugnr:_Subset_by_node_value."><span class="tocnumber">3.1</span> <span class="toctext">ugnr: Subset by node value.</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#uger:_Subset_by_edge_value."><span class="tocnumber">3.2</span> <span class="toctext">uger: Subset by edge value.</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#ugfr:_Subset_by_face_value."><span class="tocnumber">3.3</span> <span class="toctext">ugfr: Subset by face value.</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Retired_Functions"><span class="tocnumber">4</span> <span class="toctext">Retired Functions</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#The_ugr5_Function"><span class="tocnumber">4.1</span> <span class="toctext">The ugr5 Function</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#Sample_Data"><span class="tocnumber">5</span> <span class="toctext">Sample Data</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview"><span class="mw-headline-number">1</span> Overview</span></h2>
<p>We have written server functions that utilize Bill Howe's Gridfields library to subset unstructured grids (aka irregular meshes) that conform to the UGrid 0.9 specification that is part of the CF-1.6 specification. Our function has a little latitude in its requirements because it also supports features found in earlier versions of the UGrid specification (e.g., the 'mesh array' can be either the Nx3 or 3xN). However, our function only supports triangular (2D) meshes, not the other mesh schemes outlined in the specification. The function will subset one or more <i>range variables</i> based on the values of the <i>domain variables</i> as expressed in a simple relational expression. The result of the function is an unstructured grid - that is, the subsetting operation will return a a set of variables that could be written to a netcdf file and the result would conform to the UGrid 0.9 specification. Because the specification has evolved over time and older data are still perfectly valid, we often 'tweak' those older datasets using NcML so that the contain the variables and attributes required by the newer versions of the UGrid specification. Our function supports both zero- and ones-based indexing for both the range and domain variables.
</p>
<h2><span class="mw-headline" id="Background_information_on_UGrid_0.9.0"><span class="mw-headline-number">2</span> Background information on UGrid 0.9.0</span></h2>
<p>The <a rel="nofollow" class="external text" href="https://github.com/ugrid-conventions">UGrid specification</a> moved to GitHub in 2013. The 0.9.0 version of the specification was last edited on 29 Oct 2013. Our function conforms to that specification and to an older version (0.6?), where the major difference is the organization of the mesh array data. For a triangular array, the 0.9.0 version specifies the array be a Nx3 while the older specification specified a 3xN. Our code supports both.
</p>
<h2><span class="mw-headline" id="The_ugrid_subsetting_functions"><span class="mw-headline-number">3</span> The ugrid subsetting functions</span></h2>
<p>These functions allow you to subset the UGrid dataset by the values associated with nodes, edges, or faces.
</p>
<h3><span class="mw-headline" id="ugnr:_Subset_by_node_value."><span class="mw-headline-number">3.1</span> ugnr: Subset by node value.</span></h3>
<dl>
<dt>Name
</dt>
<dd><i><b>ugnr</b></i> - Subset an unstructured 2D Mesh Topology grid based on domain values associated with the nodes
</dd>
<dt>Syntax
</dt>
<dd> <tt>ugnr(rangeVariable:string, [rangeVariable:string, ... ] condition:string)</tt>
<ul>
<li> The first, second, ..., parameter is a list of (<i>range</i>) data variable names that you wish to subset, they may be associated with nodes, edges, or faces of the mesh.
</li>
<li> The last parameter is an expression that defines conditions that the <i>domain</i> variables must meet in order to be included in the result. 
</li>
</ul>
</dd>
<dd> Here is an example:
<dl>
<dd> <tt>ugnr(depth, "28.0&lt;lat &amp; lat&lt;29.0 &amp; -89.0&lt;lon &amp; lon&lt;-88.0")</tt>
</dd>
</dl>
</dd>
<dd> Used in a url (that returns the DDS for the subset data):
<dl>
<dd> <tt><a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/Ike/2D_varied_manning_windstress/test_dir-norename.ncml.dds?ugnr(depth,%2228.0%3Clat&amp;lat%3C29.0&amp;-89.0%3Clon&amp;lon%3C-88.0%22)">http://52.70.199.67:8080/opendap/hyrax/ugrids/Ike/2D_varied_manning_windstress/test_dir-norename.ncml.dds?ugnr(depth,"28.0&lt;lat &amp; lat&lt;29.0 &amp; -89.0&lt;lon &amp; lon&lt;-88.0")</a></tt>
</dd>
</dl>
</dd>
</dl>
<dl>
<dt> Subsetting the range variables
</dt>
<dd> In the example dataset <a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc">NECOFS_GOM3_FORECAST.nc</a> (<a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc.dds">DDS</a> <a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc.das">DAS</a>) we can see that there are range variables associated with the nodes of the mesh that have a <i>time</i> dimension and a <i>siglay</i> dimension. Since the <i>time</i> dimension has 145 values, and <i>siglay</i> dimension has 40 values it may be that you wish to only retrieve a single time slice and/or siglay slice. This can accomplished by using an array constraint on the variable as it is passed to the ugrid function. For example, to retrieve the 12th siglay slice of the 5th time slice of the variable salinity you would constrain it like <i>salinity[4][11][*]</i> (note that the indices begin at zero). In the request URL the function call is
<dl>
<dd><tt><a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc.dds?ugnr(salinity%5B4%5D%5B11%5D%5B*%5D,%2238.0%3Clat%20&amp;%20lat%3C42.0%20&amp;%20-64.0%3Clon%20&amp;%20lon%3C-60.0%22)">ugnr(salinity[4][11][*],&quot;38.0&lt;lat &amp; lat&lt;42.0 &amp; -64.0&lt;lon &amp; lon&lt;-60.0&quot;)</a></tt>
</dd>
</dl>
</dd>
<dd> It is also possible to request, say, every 5th time slice  <i>salinity[0:5:*][*][*]</i> or every 3rd siglay slice from 3 to 30 <i>salinity[4][3:3:30][*]</i>. In a request URL this would look like
<dl>
<dd><tt><a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc.dds?ugnr(salinity%5B4%5D%5B3:3:30%5D%5B*%5D,%2238.0%3Clat%20&amp;%20lat%3C42.0%20&amp;%20-64.0%3Clon%20&amp;%20lon%3C-60.0%22)">ugnr(salinity[4][3:3:30][*],&quot;38.0&lt;lat &amp; lat&lt;42.0 &amp; -64.0&lt;lon &amp; lon&lt;-60.0&quot;)</a></tt>
</dd>
</dl>
</dd>
</dl>
<h3><span class="mw-headline" id="uger:_Subset_by_edge_value."><span class="mw-headline-number">3.2</span> uger: Subset by edge value.</span></h3>
<dl>
<dt>Name
</dt>
<dd><i><b>uger</b></i> - Subset an unstructured 2D Mesh Topology grid based on domain values associated with the edges
</dd>
<dt>Syntax
</dt>
<dd> <tt>uger(rangeVariable:string, [rangeVariable:string, ... ] condition:string)</tt>
<ul>
<li> The first, second, ..., parameter is a list of (<i>range</i>) data variable names that you wish to subset, they may be associated with nodes, edges, or faces of the mesh.
</li>
<li> The last parameter is an expression that defines conditions that the <i>domain</i> variables must meet in order to be included in the result. 
</li>
</ul>
</dd>
<dd> Here is an example:
<dl>
<dd> <tt> uger(depth, "28.0&lt;lat &amp; lat&lt;29.0 &amp; -89.0&lt;lon &amp; lon&lt;-88.0")</tt>
</dd>
</dl>
</dd>
</dl>
<h3><span class="mw-headline" id="ugfr:_Subset_by_face_value."><span class="mw-headline-number">3.3</span> ugfr: Subset by face value.</span></h3>
<dl>
<dt>Name
</dt>
<dd><i><b>ugfr</b></i> - Subset an unstructured 2D Mesh Topology grid based on domain values associated with the faces
</dd>
<dt>Syntax
</dt>
<dd> <tt> ugfr(rangeVariable:string, [rangeVariable:string, ... ] condition:string)</tt>
<ul>
<li> The first, second, ..., parameter is a list of (<i>range</i>) data variable names that you wish to subset, they may be associated with nodes, edges, or faces of the mesh.
</li>
<li> The last parameter is an expression that defines conditions that the <i>domain</i> variables must meet in order to be included in the result. 
</li>
</ul>
</dd>
<dd> Here is an example:
<dl>
<dd> <tt> ugfr(depth, "28.0&lt;lat &amp; lat&lt;29.0 &amp; -89.0&lt;lon &amp; lon&lt;-88.0")</tt>
</dd>
</dl>
</dd>
</dl>
<p><br />
</p>
<h2><span class="mw-headline" id="Retired_Functions"><span class="mw-headline-number">4</span> Retired Functions</span></h2>
<h3><span class="mw-headline" id="The_ugr5_Function"><span class="mw-headline-number">4.1</span> The ugr5 Function</span></h3>
<p><i><b>This function is deprecated.</b> Supported by Hyrax 1.12.2 and earlier.</i>
</p>
<dl>
<dt>Name
</dt>
<dd>ugr5 - Restrict the domain of an unstructured 2D Mesh Topology grid 
</dd>
</dl>
<dl>
<dt>Syntax
</dt>
<dd>ugr5(0, rangeVariable:string, [rangeVariable:string, ... ] condition:string)
<ul>
<li> The first parameter indicates that the supplied relational constraint condition is to be applied to coordinate values at the nodes (0) or the faces (2) of the mesh.
</li>
<li> The second, third, ..., parameter is a list of (<i>range</i>) data variables that you wish to subset, they may be associated with nodes or faces of the mesh.
</li>
<li> The last parameter is an expression that defines conditions that the <i>domain</i> variables must meet in order to be included in the result. 
</li>
</ul>
</dd>
<dd> Here is an example:
<dl>
<dd> ugr5(0, depth, "28.0&lt;lat &amp; lat&lt;29.0 &amp; -89.0&lt;lon &amp; lon&lt;-88.0")
</dd>
</dl>
</dd>
<dd> Used in a url (that returns the DDS for the subset data):
<dl>
<dd> <a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/Ike/2D_varied_manning_windstress/test_dir-norename.ncml.dds?ugr5(0,depth,%2228.0%3Clat&amp;lat%3C29.0&amp;-89.0%3Clon&amp;lon%3C-88.0%22)">http://52.70.199.67:8080/opendap/hyrax/ugrids/Ike/2D_varied_manning_windstress/test_dir-norename.ncml.dds?ugr5(0,depth,"28.0&lt;lat &amp; lat&lt;29.0 &amp; -89.0&lt;lon &amp; lon&lt;-88.0")</a>
</dd>
</dl>
</dd>
</dl>
<dl>
<dt> Subsetting the range variables
</dt>
<dd> In the example dataset <a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc">NECOFS_GOM3_FORECAST.nc</a> (<a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc.dds">DDS</a> <a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc.das">DAS</a>) we can see that there are range variables associated with the nodes of the mesh that have a <i>time</i> dimension and a <i>siglay</i> dimension. Since the <i>time</i> dimension has 145 values, and <i>siglay</i> dimension has 40 values it may be that you wish to only retrieve a single time slice and/or siglay slice. This can accomplished by using an array constraint on the variable as it is passed to the ugrid function. For example, to retrieve the 12th siglay slice of the 5th time slice of the variable salinity you would constrain it like <i>salinity[4][11][*]</i> (note that the indices begin at zero). In the request URL the function call is
<dl>
<dd> <a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc.dds?ugr5(0,salinity%5B4%5D%5B11%5D%5B*%5D,%2238.0%3Clat%20&amp;%20lat%3C42.0%20&amp;%20-64.0%3Clon%20&amp;%20lon%3C-60.0%22)">ugr5(0,salinity[4][11][*],&quot;38.0&lt;lat &amp; lat&lt;42.0 &amp; -64.0&lt;lon &amp; lon&lt;-60.0&quot;)</a>
</dd>
</dl>
</dd>
<dd> It is also possible to request, say, every 5th time slice  <i>salinity[0:5:*][*][*]</i> or every 3rd siglay slice from 3 to 30 <i>salinity[4][3:3:30][*]</i>. In a request URL this would look like
<dl>
<dd><a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/hyrax/ugrids/NECOFS_GOM3_FORECAST.nc.dds?ugr5(0,salinity%5B4%5D%5B3:3:30%5D%5B*%5D,%2238.0%3Clat%20&amp;%20lat%3C42.0%20&amp;%20-64.0%3Clon%20&amp;%20lon%3C-60.0%22)">ugr5(0,salinity[4][3:3:30][*],&quot;38.0&lt;lat &amp; lat&lt;42.0 &amp; -64.0&lt;lon &amp; lon&lt;-60.0&quot;)</a>
</dd>
</dl>
</dd>
</dl>
<h2><span class="mw-headline" id="Sample_Data"><span class="mw-headline-number">5</span> Sample Data</span></h2>
<p>A server with unstructured grid data and subsetting function on board is here: <a rel="nofollow" class="external free" href="http://52.70.199.67:8080/opendap/">http://52.70.199.67:8080/opendap/</a>
</p><p>In the directory <a rel="nofollow" class="external text" href="http://52.70.199.67:8080/opendap/ugrids/">ugrids</a> You can find a number of test datasets:
</p>
<dl>
<dt> fvcom_1step.nc, hex.nc
</dt>
<dd> These are test data from Bill Howe. The <i>hex</i> file is small but it lacks the special variable the UGrid uses to encode metadata the function depends on to read the unstructured data.
</dd>
<dt> test4.nc, test4-rename-nodedata.ncml, test4-ugrid.ncml
</dt>
<dd> <i>test4</i> also lacks the special 'metadata variable' but we have written NcML (<i>test4-ugrid</i>) that adds it to the dataset, so you can use ugr5() with a URL that points at the virtual dataset that NcML file defines. The companion NcML file (<i>test4-rename-nodedata.ncml</i>) uses NcML to rename the node data variable and while this works fine for normal DAP accesses, the ugr5() won't work with this - the purpose of this example is to document a known bug where using NcML to rename a range variable breaks the function.
</dd>
<dt> NECOFS_GOM3_FORECAST.nc, NECOFS_WAVE_FORECAST.nc
</dt>
<dd> These files us a 3xN face node connectivity array (corresponding to the older version of the UGrid specification)
</dd>
<dt> Ike/2D_varied_manning_windstress and Ike/2D_varied_manning_windstress_wave
</dt>
<dd> These directories have data from c. 2008 that requires (minimal) NcML to work with our function
</dd>
<dt> RENCI
</dt>
<dd> Data used by the ODSIP EarthCube project. This directory has the same data (or nearly so) where the face node connectivity array is organized a Nx3 and 3xN.
</dd>
<dt> lana
</dt>
<dd> This is a bit of a mystery; it may have been lumped into the ugrid sample data by mistake.
</dd>
<dt> README
</dt>
<dd> A brief recap of this information
</dd>
</dl>
<p><br />
</p>



</div>
				<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
</body></html>