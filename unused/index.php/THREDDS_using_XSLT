
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>THREDDS using XSLT - OPeNDAP Documentation</title>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-THREDDS_using_XSLT skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary" role="main">
	
	
	<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">THREDDS using XSLT</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From OPeNDAP Documentation</div>
		<div id="contentSub"></div>
		

		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Background"><span class="tocnumber">1</span> <span class="toctext">Background</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#BES_THREDDS_Handler"><span class="tocnumber">2</span> <span class="toctext">BES THREDDS Handler</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Default_Configuration"><span class="tocnumber">2.1</span> <span class="toctext">Default Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#THREDDS_Dispatch_Handler"><span class="tocnumber">3</span> <span class="toctext">THREDDS Dispatch Handler</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Memory_Caching"><span class="tocnumber">3.1</span> <span class="toctext">Memory Caching</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Cache_Updates"><span class="tocnumber">3.1.1</span> <span class="toctext">Cache Updates</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#prefix"><span class="tocnumber">3.2</span> <span class="toctext">prefix</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Presentation_View_.28HTML.29"><span class="tocnumber">3.3</span> <span class="toctext">Presentation View (HTML)</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Default_configuration_2"><span class="tocnumber">3.4</span> <span class="toctext">Default configuration</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Background"><span class="mw-headline-number">1</span> Background</span></h2>
<p>Prior to Hyrax 1.5 THREDDS catalog functionality in Hyrax was provided using an imported implementation of THREDDS.  This was a large and complex dependancy for Hyrax, and the implementation had significant scalability problems for large catalogs (Catalogs with 20k or more entries would consume all available memory.)
</p><p>In response to this we have written new code for Hyrax. We have replaced the imported code with 2 OLFS handlers.
</p>
<h2><span class="mw-headline" id="BES_THREDDS_Handler"><span class="mw-headline-number">2</span> BES THREDDS Handler</span></h2>
<p>The <i>opendap.bes.BESThreddsDispatchHandler</i>  provides THREDDS catalogs for all data served from a BES. It requires no configuration. Simply adding it to the olfs configuration (file: <i>$CATALINA_HOME/content/opendap/olfs.xml</i>) will provide THREDDS catalogs for data served from the BES. 
</p><p>This handler uses XSL transforms to convert the BES &lt;showCatalog&gt; response into a THREDDS catalog.
</p>
<h3><span class="mw-headline" id="Default_Configuration"><span class="mw-headline-number">2.1</span> Default Configuration</span></h3>
<pre>           &lt;Handler className="opendap.bes.BESThreddsDispatchHandler" /&gt;
</pre>
<h2><span class="mw-headline" id="THREDDS_Dispatch_Handler"><span class="mw-headline-number">3</span> THREDDS Dispatch Handler</span></h2>
<p>The <i>opendap.threddsHandler.Dispatch</i> handler provides THREDDS catalog functionality for static THREDDS catalogs located on the system with the OLFS. The handler uses XSL transforms to provide HTML presentation views of both the catalogs and individual datasets within the catalog. Much like the TDS, data access links are available on the dataset pages (if the catalog contains the information for the access links).
</p>
<h3><span class="mw-headline" id="Memory_Caching"><span class="mw-headline-number">3.1</span> Memory Caching</span></h3>
<p>The implementation can be configured to use memory caching of THREDDS catalogs to improve speed and reduce disk thrashing. 
</p><p>When memory caching is enabled, the handler will traverse the local THREDDS catalogs at startup. Each catalog file will be read into a memory buffer and cached. The memory buffer is parsed to verify that the catalog represents valid XML, but the resulting document is not saved. When a <i>thredds:catalogRef</i> element is encountered during the traversal its  <i>href</i> is evaluated:
</p>
<ul>
<li> If the <i>href</i> is a relative URL (does not begin with a "/" or "http://<i>) then the catalog is traversed and cached.</i>
</li>
<li> If the <i>href</i> begins with a "/" character it is assumed that the catalog is being provided by another service on the same system, and it is not traversed or cached.
</li>
<li> If the <i>href</i> begins with a "http://" it is assumed to be a remotely hosted catalog provided by another service on a different system, and it is not traversed or cached.
</li>
</ul>
<p>When a client asks for an XML catalog response, the entire cached buffer for the catalog is dumped to the client in a single write command. This should be very fast, as all that must happen is an existing byte buffer is written to the response stream. 
</p><p>If the client is asking for an HTML view of the catalog, the buffer is parsed and passed through an XSL transform to generate the HTML page. The thinking behind this is that machines will be traversing the XML files and would require very fast response times, while humans will be traversing the HTML views of the catalog and the latency generated by parsing and performing the transform would be acceptable to most users.
</p><p>If memory caching is disabled, then the start up remains the same, except no data is cached. Subsequent client requests for THREDDS products are handled in the same manner as before, only the catalog content is read from disk each time. Although this means that the XML responses will be much slower, it will scale to handle much larger static catalog collections.
</p>
<h4><span class="mw-headline" id="Cache_Updates"><span class="mw-headline-number">3.1.1</span> Cache Updates</span></h4>
<p>Each time a catalog request is processed the source file's last modified date is checked. If the catalog in memory was cached prior to the last modified date, it and all of it's descendants in the catalog hierarchy are purged from the cache and reloaded.
</p>
<h3><span class="mw-headline" id="prefix"><span class="mw-headline-number">3.2</span> prefix</span></h3>
<p>This handler requires a prefix element in the configuration: <tt>&lt;prefix&gt;thredds&lt;/prefix&gt;</tt>The value of the prefix element is used by the handler to identify requests intended for it. Basically it will claim any request whose path begins with the prefix.
</p><p>For example, if the prefix is set to "thredds", then this request:
</p>
<dl>
<dd> <i>http://localhost:8080/opendap/thredds/catalog.xml</i>
</dd>
</dl>
<p>Will be claimed by the handler while this request: 
</p>
<dl>
<dd> <i>http://localhost:8080/opendap/catalog.xml</i>
</dd>
</dl>
<p>Will not. (Although it would be claimed by the BES THREDDS Handler)
</p>
<h3><span class="mw-headline" id="Presentation_View_.28HTML.29"><span class="mw-headline-number">3.3</span> Presentation View (HTML)</span></h3>
<p>Supplanting the <i>.xml</i> at the end of a catalog's name with <i>.html</i> will cause the opendap.threddsHandler.Dispatch to return an HTML presentation view of the catalog. This is accomplished by parsing the catalog.xml document (either from memory if cached, or from disk if not) and running the resulting document through an XSL transform. All the metadata for all thredds:dataset elements can be inspected in a separate HTML page that details the dataset. This page is also generated by an XSL transform applied to the catalog XML document.
</p><p><br />
</p><p><br />
</p>
<h3><span class="mw-headline" id="Default_configuration_2"><span class="mw-headline-number">3.4</span> Default configuration</span></h3>
<pre>           &lt;Handler className="opendap.threddsHandler.Dispatch"&gt;
               &lt;prefix&gt;thredds&lt;/prefix&gt;
               &lt;useMemoryCache&gt;true&lt;/useMemoryCache&gt;
           &lt;/Handler&gt;
</pre>



</div>
				<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
</body></html>