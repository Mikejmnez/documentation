
<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>Hyrax - Configuring The OLFS To Work With Multiple BES's - OPeNDAP Documentation</title>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Hyrax_-_Configuring_The_OLFS_To_Work_With_Multiple_BES_s skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary" role="main">
	
	
	<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Hyrax - Configuring The OLFS To Work With Multiple BES's</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From OPeNDAP Documentation</div>
		<div id="contentSub"></div>
		

		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Configuring Hyrax to use multiple BES backends is straight forward. It will require that you edit the <b>olfs.xml</b> file and possible the <b>catalog.xml</b> file.
</p><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Top_Level_.28root.29_BES"><span class="tocnumber">1</span> <span class="toctext">Top Level (<i>root</i>) BES</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Single_BES_Example_.28Default.29"><span class="tocnumber">2</span> <span class="toctext">Single BES Example (Default)</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Multiple_BES_examples"><span class="tocnumber">3</span> <span class="toctext">Multiple BES examples</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Mount_points"><span class="tocnumber">4</span> <span class="toctext">Mount points</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Complete_olfs.xml_with_multiple_BES_installations_example"><span class="tocnumber">5</span> <span class="toctext">Complete olfs.xml with multiple BES installations example</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Top_Level_.28root.29_BES"><span class="mw-headline-number">1</span> Top Level (<i>root</i>) BES</span></h1>
<p>Every installation of Hyrax requires a top level (or <i>root</i> level) BES.** This BES has a <i>prefix</i> of "/" (the forward slash character). The prefix is a URL token between the server address/port and catalog root used to designate a particular BES instance in the case that multiple Back-End-Servers are available to a single OLFS. The default (for a single BES) is no additional tag, designated by "/". The prefix is used to provide a mapping for each BES connected to the OLFS to URI space serviced by the OLFS.
</p><p>In a single BES deployment this BES would contain all of the data resources to be made visible in Hyrax. In the THREDDS <i>catalog.xml</i> file each top level directory/collection would have it's own &lt;<i>datasetScan</i>&gt; element.
</p><p><br />
**<i>Note:</i> The word <i>root</i> here has <b>absolutely nothing</b> to do with the login account called root associated with the super user or system administrator.
</p>
<h1><span class="mw-headline" id="Single_BES_Example_.28Default.29"><span class="mw-headline-number">2</span> Single BES Example (Default)</span></h1>
<p>Here is the &lt;<i>Handler</i>&gt; element in an <b>olfs.xml</b> that defines the opendap.bes.BESManager file that configures the OLFS to use a single BES, the default configuration arrangement for Hyrax:
</p>
<pre>
    &lt;Handler className=&quot;opendap.bes.BESManager&quot;&gt;
        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;localhost&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
    &lt;/Handler&gt;
</pre>
<p>The BES is running on the same system as the OLFS, and it's prefix is correctly set to "/". This BES will handle all data requests directed at the OLFS and will expose it's top level directory/collection/catalog in the URI space of the OLFS here:
</p>
<pre><a rel="nofollow" class="external free" href="http://localhost:8080/opendap/">http://localhost:8080/opendap/</a>
</pre>
<p>The THREDDS <b>catalog.xml</b> file for this should contain a &lt;<i>datasetScan</i>&gt; element for each of the top level directories | collections | catalogs that the BES exposes at the above URI.
</p><p><i><b>Remember</b></i>: There <b>must</b> be one (but only one) BES configured with the &lt;<i>prefix</i>&gt; set to "/" in your <b>olf.xml</b> file.
</p>
<h1><span class="mw-headline" id="Multiple_BES_examples"><span class="mw-headline-number">3</span> Multiple BES examples</span></h1>
<p>Here is a BESManager &lt;<i>Handler</i>&gt; element that defines two BES's:
</p>
<pre>
    &lt;Handler className=&quot;opendap.bes.BESManager&quot;&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;localhost&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
        &lt;BES&gt;
            &lt;prefix&gt;/sst&lt;/prefix&gt;
            &lt;host&gt;comet.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;

    &lt;/Handler&gt;
</pre>
<p>The first one is running on the same system as the OLFS,  the second on <i>comet. test.org</i>. The second BES is mapped to the prefix /sst. So the URL:
</p>
<pre><a rel="nofollow" class="external free" href="http://localhost:8080/opendap/">http://localhost:8080/opendap/</a>
</pre>
<p>Will return the directory view at the top level of the first BES, running on the same system as the OLFS. The URL:
</p>
<pre><a rel="nofollow" class="external free" href="http://localhost:8080/opendap/sst">http://localhost:8080/opendap/sst</a>
</pre>
<p>Will return the directory view at the top level of the second BES, running on <i>comet.test.org</i>.
</p><p>You can repeat this pattern to add more BES's to the configuration. This next example shows a configuration with 4 BES's: The <i>root</i> BES, and 3 others:
</p>
<pre>
    &lt;Handler className=&quot;opendap.bes.BESManager&quot;&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;server0.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
        &lt;BES&gt;
            &lt;prefix&gt;/sst&lt;/prefix&gt;
            &lt;host&gt;server1.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/chl-a&lt;/prefix&gt;
            &lt;host&gt;server2.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/salinity&lt;/prefix&gt;
            &lt;host&gt;server3.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;

    &lt;/Handler&gt;
</pre>
<p>Note that in this example:
</p>
<ol>
<li> The <i>root</i> BES is not necessarily running on the same host as the OLFS.
</li>
<li> Every BES has a different prefix.
</li>
<li> The OLFS would direct requests so that requests to:
<ul>
<li> <a rel="nofollow" class="external free" href="http://localhost:8080/opendap/sst/*">http://localhost:8080/opendap/sst/*</a> are handled by the BES at server1.test.org
</li>
<li> <a rel="nofollow" class="external free" href="http://localhost:8080/opendap/chl-a/*">http://localhost:8080/opendap/chl-a/*</a> are handled by the BES at server2.test.org
</li>
<li> <a rel="nofollow" class="external free" href="http://localhost:8080/opendap/salinity/*">http://localhost:8080/opendap/salinity/*</a> are handled by the BES at server3.test.org
</li>
<li> The BES at server0.test.org would handle everything else.
</li>
</ul>
</li>
</ol>
<h1><span class="mw-headline" id="Mount_points"><span class="mw-headline-number">4</span> Mount points</span></h1>
<p>In a multiple BES installation each additional BES must have a <i>mount point</i> within the exposed hierarchy of collections for it to be visible in Hyrax. 
</p><p>Consider, if you have this configuration:
</p>
<pre>
    &lt;Handler className=&quot;opendap.bes.BESManager&quot;&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;server0.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
    &lt;/Handler&gt;
</pre>
<p>And the top level directory for the <i>root</i> BES looks like this:
</p><p><a href="../index.php/File:TopDir.png" class="image" title="Top Level Directory"><img alt="Top Level Directory" src="../images/7/75/TopDir.png" width="626" height="246" /></a>
</p><p>If you add another BES, like this:
</p>
<pre>
    &lt;Handler className=&quot;opendap.bes.BESManager&quot;&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;server0.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
        &lt;BES&gt;
            &lt;prefix&gt;/sst&lt;/prefix&gt;
            &lt;host&gt;server5.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
    &lt;/Handler&gt;
</pre>
<p><b>It will not appear in the top level directory unless you create a <i>mount point</i>.</b> This simply means that on the file system served by the <i>root</i> BES you would need to create a directory called "sst" in the top of the directory tree that the <i>root</i> BES is exposing. In other words, simply create a directory called "sst" in the same directory that contains the  "Test" and "data" directories on server0.test.org. After you did that your top level directory would look like this:
</p><p><a href="../index.php/File:TopDir2.png" class="image" title="Top Level Directory"><img alt="Top Level Directory" src="../images/2/23/TopDir2.png" width="626" height="258" /></a>
</p><p>This holds true for any arrangement of BESs that you make. The location of the <i>mount point</i> will depend on your configuration, and how you organize things. Here is a more complex example.
</p><p>Consider this configuration:
</p>
<pre>
    &lt;Handler className=&quot;opendap.bes.BESManager&quot;&gt;

        &lt;BES&gt;
            &lt;prefix&gt;/&lt;/prefix&gt;
            &lt;host&gt;server0.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature &lt;/prefix&gt;
            &lt;host&gt;server1.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature/NorthAmerica&lt;/prefix&gt;
            &lt;host&gt;server2.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature/NorthAmerica/Canada &lt;/prefix&gt;
            &lt;host&gt;server3.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature/NorthAmerica/USA &lt;/prefix&gt;
            &lt;host&gt;server4.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
        &lt;BES&gt;
            &lt;prefix&gt;/GlobalTemperature/Europe/France &lt;/prefix&gt;
            &lt;host&gt;server4.test.org&lt;/host&gt;
            &lt;port&gt;10022&lt;/port&gt;
            &lt;ClientPool maximum=&quot;10&quot; /&gt;
        &lt;/BES&gt;
        
    &lt;/Handler&gt;
</pre>
<ul>
<li>The <i>mount point</i> "GlobalTemperature" must be in the top of the directory tree that the <i>root</i> BES  on server0.test.org is exposing.
</li>
<li>The <i>mount point</i> "NorthAmerica" must be in the top of the directory tree that the BES on server1.test.org is exposing.
</li>
<li>The <i>mount point</i> "Canada" must be in the top of the directory tree that the BES on server2.test.org is exposing.
</li>
<li>The <i>mount point</i> "USA" must be in the top of the directory tree that the BES on server2.test.org is exposing.
</li>
<li>The <i>mount point</i> "France" must be located at "GlobalTemperature/Europe/France" relative to the top of the directory tree that the BES on server0.test.org is exposing.
</li>
</ul>
<h1><span class="mw-headline" id="Complete_olfs.xml_with_multiple_BES_installations_example"><span class="mw-headline-number">5</span> Complete olfs.xml with multiple BES installations example</span></h1>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;OLFSConfig&gt;

    &lt;DispatchHandlers&gt;

        &lt;HttpGetHandlers&gt;

            &lt;Handler className=&quot;opendap.bes.BESManager&quot;&gt;

                &lt;BES&gt;
                    &lt;prefix&gt;/&lt;/prefix&gt;
                    &lt;host&gt;server0.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum=&quot;10&quot; /&gt;
                &lt;/BES&gt;
                
                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature &lt;/prefix&gt;
                    &lt;host&gt;server1.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum=&quot;10&quot; /&gt;
                &lt;/BES&gt;
                
                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature/NorthAmerica&lt;/prefix&gt;
                    &lt;host&gt;server2.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum=&quot;10&quot; /&gt;
                &lt;/BES&gt;
                
                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature/NorthAmerica/Canada &lt;/prefix&gt;
                    &lt;host&gt;server3.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum=&quot;10&quot; /&gt;
                &lt;/BES&gt;
                
                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature/NorthAmerica/USA &lt;/prefix&gt;
                    &lt;host&gt;server4.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum=&quot;10&quot; /&gt;
                &lt;/BES&gt;
                
                &lt;BES&gt;
                    &lt;prefix&gt;/GlobalTemperature/Europe/France &lt;/prefix&gt;
                    &lt;host&gt;server4.test.org&lt;/host&gt;
                    &lt;port&gt;10022&lt;/port&gt;
                    &lt;ClientPool maximum=&quot;10&quot; /&gt;
                &lt;/BES&gt;

            &lt;/Handler&gt;

            &lt;Handler className=&quot;opendap.coreServlet.SpecialRequestDispatchHandler&quot; /&gt;
            
            &lt;Handler className=&quot;opendap.bes.VersionDispatchHandler&quot; /&gt;

            &lt;Handler className=&quot;opendap.bes.DirectoryDispatchHandler&quot;&gt;
                &lt;DefaultDirectoryView&gt;OPeNDAP&lt;/DefaultDirectoryView&gt;
            &lt;/Handler&gt;

            &lt;Handler className=&quot;opendap.bes.DapDispatchHandler&quot; /&gt;

            &lt;Handler className=&quot;opendap.bes.FileDispatchHandler&quot; &gt;
                &lt;!-- &lt;AllowDirectDataSourceAccess /&gt; --&gt;
            &lt;/Handler&gt;

            &lt;Handler className=&quot;opendap.bes.ThreddsDispatchHandler&quot; /&gt;

        &lt;/HttpGetHandlers&gt;

        &lt;HttpPostHandlers&gt;
            &lt;Handler className=&quot;opendap.coreServlet.SOAPRequestDispatcher&quot; &gt;
                &lt;OpendapSoapDispatchHandler&gt;opendap.bes.SoapDispatchHandler&lt;/OpendapSoapDispatchHandler&gt;
            &lt;/Handler&gt;
        &lt;/HttpPostHandlers&gt;

    &lt;/DispatchHandlers&gt;

&lt;/OLFSConfig&gt;

</pre>




</div>
				<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
</body></html>